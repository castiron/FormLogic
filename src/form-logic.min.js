/* form-logic 2013-12-06 */
(function(){var a;this.FormLogic=function(){function a(){return a._instance?a._instance:(a._validators={},this.buildDefaultValidators(),this.setupValidationHandlers(),this.setupPrompts(),this.setupMasks(),this.hideErrorTargets(),this.fieldErrorClass="has-error",this.errorClass="error",a._instance=this,void 0)}return a.validate=function(b,c){if(!c||"function"!=typeof c)throw"The second argument passed to FormLogic.validator() must be a function.";return a._validators[b]=c},a.onValidSubmit=function(a,b){if(!b||"function"!=typeof b)throw"The second argument passed to FormLogic.onValidSubmit() must be a function.";return $(a).data("fl-submit-callback",b)},a.prototype.setupMasks=function(){return $("[data-mask]").each(function(a,b){var c,d,e;return c=$(b),d=c.data("mask"),""!==$.trim(d)&&(e=c.prop("type"),"text"===e||"textfield"===e||"input"===e)?c.on("input",function(){var a,b,c,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;for(c=$(this).val().replace(/( )+$/,""),m=function(){var a;return a=0,function(){return c.charAt(a++)}}(),l=function(a){var b;return b=m(),b?a(b)?b:l(a):!1},g=function(a){var b;return 47<(b=a.charCodeAt(0))&&58>b},e=function(a){var b,c;return 64<(b=a.charCodeAt(0))&&91>b||96<(c=a.charCodeAt(0))&&123>c},f=function(a){return g(a)||e(a)},j="",a=0,h="",o=p=0,r=d.length;r>=0?r>=p:p>=r;o=r>=0?++p:--p){switch(i=d.charAt(o)){case"0":k=l(g);break;case"A":k=l(e),k!==!1&&k.toUpperCase();break;case"a":k=l(e),k!==!1&&k.toLowerCase();break;case"Z":k=l(e);break;case"?":k=l(f);break;case"X":k=l(f),k!==!1&&k.toUpperCase();break;case"x":k=l(f),k!==!1&&k.toLowerCase();break;case"\\":k=d.charAt(++o);break;default:k=i,h+=i}if(k===!1)break;++a,j+=k}for(n=0,b=q=-1,s=-1*j.length;(s>=-1?s>=q:q>=s)&&j.substr(b,1)===h.substr(b,1);b=s>=-1?++q:--q)++n;return 0!==n&&(j=j.slice(0,-1*n),a-=n),this.setSelectionRange&&this.selectionStart!==c.length&&(a=this.selectionStart>c.length?this.selectionStart+1:this.selectionStart),$(this).val(j),this.setSelectionRange?this.setSelectionRange(a,a):void 0}):void 0})},a.prototype.setupPrompts=function(){var a,b,c,d,e,f,g;for(c=function(a){var b,c,d,e,f,g,h,i,j;for(a.show(),h=a.find("[name]").addBack("[name]"),d=0,f=h.length;f>d;d++)c=h[d],b=$('[data-prompt="'+$(c).attr("name")+'"'),b&&$(c).change();for(i=a.find("[id]").addBack("[id]"),j=[],e=0,g=i.length;g>e;e++)c=i[e],b=$('[data-prompt="#'+$(c).attr("id")+'"'),b?j.push($(c).change()):j.push(void 0);return j},b=function(a){var c,d,e,f,g,h,i,j,k;for(a.hide(),i=a.find("[name]").addBack("[name]"),e=0,g=i.length;g>e;e++)d=i[e],c=$('[data-prompt="'+$(d).attr("name")+'"]'),c&&b(c);for(j=a.find("[id]").addBack("[id]"),k=[],f=0,h=j.length;h>f;f++)d=j[f],c=$('[data-prompt="#'+$(d).attr("id")+'"]'),c?k.push(b(c)):k.push(void 0);return k},f=$("form"),g=[],d=0,e=f.length;e>d;d++)a=f[d],g.push($("[data-prompt]").each(function(a,d){var e,f,g,h,i,j,k,l;return e=$(d),f=e.parent("form"),e.hide(),j=e.data("prompt"),g="#"===j.charAt(0)?$(f.find(j)):$(f.find('[name="'+j+'"]')),h=e.data("show-if"),i=[],h&&(i=$.map(h.split(";"),function(a){return $.trim(a)})),l=g.prop("type"),k=g.attr("name"),g.change(function(){var a,d,g,h,j,m,n,o,p,q,r,s,t,u,v;switch(j=!1,o=[],n=$(this).val(),l){case"radio":case"checkbox":for(m=f.find('[name="'+k+'"]:checked'),p=0,s=m.length;s>p;p++)a=m[p],o.push($(a).val());break;case"select-one":case"select-multiple":for(v=$(this).find("option:selected"),q=0,t=v.length;t>q;q++)h=v[q],d=$(h).attr("value"),d&&o.push(d);break;default:o.push(n)}if(0===o.length)j=!1;else if(0===i.length&&o.length>0)j=!0;else for(r=0,u=i.length;u>r;r++)if(g=i[r],-1!==$.inArray(g,o)){j=!0;break}return j?c(e):b(e)})}));return g},a.prototype.hideErrorTargets=function(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;if(!a._instance){for(q=$("form"),k=0,n=q.length;n>k;k++)for(e=q[k],b=$(e),r=b.find("[data-validate]"),l=0,o=r.length;o>l;l++)if(f=r[l],c=$(f),j=c.data("validate"),"string"==typeof j)for(i=j.split(" "),m=0,p=i.length;p>m;m++)g=i[m],h=c.data("error-"+g),h||(h=c.data("error")),d=c.next("."+this.errorClass),h?$(h).hide():d&&d.hide();return!0}},a.prototype.setupValidationHandlers=function(){var a,b,c,d,e,f,g,h,i,j,k;for(e=this,j=$("form"),f=0,h=j.length;h>f;f++){for(c=j[f],a=$(c),k=a.find("[data-validate]"),g=0,i=k.length;i>g;g++){if(d=k[g],b=$(d),"checkbox"===$(this).attr("type")||"radio"===$(this).attr("type"))return;b.blur(function(){return e.runValidators($(this))}),b.focus(function(){return e.clearErrors($(this))})}a.submit(function(b){var c,f,g,h,i;for(f=!1,i=$(this).find("[data-validate]"),g=0,h=i.length;h>g;g++)d=i[g],e.runValidators($(d),$(this))||(f=!0);return!f&&(c=a.data("fl-submit-callback"),c&&"function"==typeof c)?c.call(a,b):!f})}},a.prototype.runValidators=function(b,c){var d,e,f,g,h,i;if(d=!1,(b.is(":hidden")&&!b.next(".chosen-container").length||b.is(":submit"))&&!b.data("force-validation"))return!1;if(g=b.data("validate"),"string"!=typeof g)return!1;for(f=g.split(" "),h=0,i=f.length;i>h;h++)e=f[h],a._validators[e]&&("required"===e||""!==b.val())&&(a._validators[e](b,c)||(this.showError(b,e),d=!0));return!d},a.prototype.clearErrors=function(a,b){var c,d;if(!a.is(":hidden")&&!a.is(":submit")||a.data("force-validation"))return a.removeClass(this.fieldErrorClass),b&&(d=a.data("error-"+b)),d||(d=a.data("error")),c=a.next("."+this.errorClass),d?$(d).hide():c?c.hide():void 0},a.prototype.showError=function(a,b){var c,d;return this.clearErrors(a,b),a.addClass(this.fieldErrorClass),b&&(c=a.data("message-"+b)),c||(c=a.data("message")),b&&(d=a.data("error-"+b)),d||(d=a.data("error")),d?$(d).show():c?a.after('<div class="'+this.errorClass+'">'+c+"</div>"):void 0},a.prototype.buildDefaultValidators=function(){return a.validate("required",function(a){var b,c,d,e,f,g;if("radio"===a.attr("type")||"checkbox"===a.attr("type")){for(b=a.attr("name"),g=$('[name="'+b+'"]'),e=0,f=g.length;f>e;e++)if(c=g[e],$(c).is(":checked"))return!0;return!1}return d=a.val(),d&&""!==a.val()}),a.validate("email",function(a){var b;return b=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,b.test(a.val())}),a.validate("number",function(a){var b,c,d;return d=parseFloat(a.val()),c=parseFloat(a.data("max")),b=parseFloat(a.data("min")),isNaN(d)||!isFinite(d)?!1:void 0!==b&&void 0!==c?d>=c&&b>=d:void 0!==b&&void 0===c?b>=d:void 0===b&&void 0!==c?d>=c:!0}),a.validate("confirm",function(a){var b;return b=a.data("confirm-target"),a.val()===$(b).val()}),a.validate("phone",function(a){var b;return b=a.val().replace(/[^\d.]/g,""),b.length>6&&b.length<16}),a.validate("length",function(a){var b,c,d;return c=a.data("min"),b=a.data("max"),d=a.val().length,void 0!==b&&void 0!==c?d>=c&&b>=d:void 0!==b&&void 0===c?b>=d:void 0===b&&void 0!==c?d>=c:!0}),a.validate("card-cvc",function(a){var b;return 3<=(b=a.val().replace(/\D/g,"").length)&&4>=b}),a.validate("card-number",function(a){var b;return b=/^(?:4[0-9]{12}(?:[0-9]{3})?|5[1-5][0-9]{14}|3[47][0-9]{13}|3(?:0[0-5]|[68][0-9])[0-9]{11}|6(?:011|5[0-9]{2})[0-9]{12}|(?:2131|1800|35\d{3})\d{11})$/,null!==a.val().replace(/\D/g,"").match(b)})},a}(),a=new FormLogic}).call(this);