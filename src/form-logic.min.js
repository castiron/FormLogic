/* form-logic 2013-09-13 */
(function(){var a,b;this.FormLogic=function(){function a(){}return a}(),a=function(){function a(a){var b,c,d,e;for(this.$el=a,this.$el.hide(),this.parentName=this.$el.data("depends-on"),this.parents=[],e=$('[name="'+this.parentName+'"]:not([type="hidden"])'),c=0,d=e.length;d>c;c++)b=e[c],$(b).is('[type="checkbox"]')?this.parentType="checkbox":$(b).is('[type="radio"]')&&(this.parentType="radio"),this.parents.push($(b));""!==this.$el.data("show-if")?this.setupShowIf():""!==this.$el.data("show-if-any")&&this.setupShowIfAny()}return a.prototype.setupShowIf=function(){var a,b,c,d,e,f,g;if(c=this.$el.data("show-if")){for(c=c.toString().split(";"),c=$.map(c,function(a){return $.trim(a)}),b=this,f=this.parents,g=[],d=0,e=f.length;e>d;d++)a=f[d],g.push(a.change(function(){var a,d,e,f;if("checkbox"===b.parentType||"radio"===b.parentType){for(f=b.parents,d=0,e=f.length;e>d;d++)if(a=f[d],a.is(":checked")&&-1!==$.inArray(a.val(),c))return b.show(),void 0;return b.hide()}return-1!==$.inArray($(this).val(),c)?b.show():b.hide()}).change());return g}},a.prototype.setupShowIfAny=function(){var a,b,c,d,e,f,g,h,i,j,k=this;if("radio"===this.parentType||"checkbox"===this.parentType){for(b=this,g=this.parents,i=[],c=0,e=g.length;e>c;c++)a=g[c],i.push(a.change(function(){var c,d,e,f;for(c=!1,f=b.parents,d=0,e=f.length;e>d;d++)a=f[d],a.is(":checked")&&(c=!0);return c?b.show():b.hide()}));return i}for(h=this.parents,j=[],d=0,f=h.length;f>d;d++)a=h[d],j.push(a.change(function(){return""!==a.val()?k.show():k.hide()}));return j},a.prototype.show=function(){var a,b,c,d,e,f,g;for(this.$el.show().data("ignore-validation",!1),f=this.$el.find("*"),g=[],d=0,e=f.length;e>d;d++)a=f[d],c=$(a).attr("name"),c?(b=$('[data-depends-on="'+c+'"]'),b.length>0?g.push($(a).change()):g.push(void 0)):g.push(void 0);return g},a.prototype.hide=function(){var a,b,c,d,e,f;for(this.$el.data("ignore-validation",!0).hide(),e=this.$el.find("*"),f=[],c=0,d=e.length;d>c;c++)a=e[c],b=$(a).attr("name"),b?f.push($('[data-depends-on="'+b+'"]').data("ignore-validation",!0).hide()):f.push(void 0);return f},a}(),b=function(){function a(a,b){var c,d,e,f,g=this;for(this.options=b,this.$el=$(a),this.$submit=this.$el.find('input[type="submit"]'),f=this.$el.find("input"),d=0,e=f.length;e>d;d++)c=f[d],this.addHint($(c));$("[data-flash-errors]").hide(),this.stripeKey=this.$el.data("stripe-key"),this.stripeKey&&Stripe.setPublishableKey(this.stripeKey),this.$submit.click(function(){var a,b,d,e,f,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;for(g.reset(),t=g.$el.find(".hasError"),j=0,m=t.length;m>j;j++)b=t[j],$(b).removeClass(".hasError");for(u=g.$el.find(".error"),k=0,n=u.length;n>k;k++)d=u[k],$(d).html("");for($("[data-flash-errors]").hide(),e=g.$el.find("input, select, textarea"),l=0,o=e.length;o>l;l++)if(c=e[l],a=$(c),!a.is(":hidden")&&!a.is(":submit")&&(a.hasClass("has-hint")&&a.val(""),!a.data("ignore-validation")&&(f=a.data("validate"),"string"==typeof f)))for(i=f.split(" "),r=0,p=i.length;p>r;r++)switch(h=i[r]){case"required":g.validateRequired(a);break;case"email":g.validateEmail(a);break;case"minimum":g.validateMinimum(a);break;case"maximum":g.validateMaximum(a);break;case"number":g.validateNumber(a);break;case"confirm":g.validateConfirm(a);break;case"stripe-number":g.validateStripeNumber(a);break;case"stripe-cvc":g.validateStripeCVC(a);break;case"stripe-expiry":g.validateStripeExpiry(a)}if(g.isValid()&&null!=FormLogic.onValidSubmit)return FormLogic.onValidSubmit();if(!g.isValid()){for($("[data-flash-errors]").show(),v=g.$el.find("input"),s=0,q=v.length;q>s;s++)c=v[s],g.addHint($(c));return!1}return!0})}return a.prototype.validateRequired=function(a){var b,c,d,e,f;if("radio"===a.attr("type")||"checkbox"===a.attr("type")){for(b=a.attr("name"),f=$('[name="'+b+'"]'),d=0,e=f.length;e>d;d++)if(c=f[d],$(c).is(":checked"))return;return this.showError(a,"required")}return""===a.val()?this.showError(a,"required"):void 0},a.prototype.validateEmail=function(a){var b,c;if(""!==a.val())return c=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,b=c.test(a.val()),b?void 0:this.showError(a,"email")},a.prototype.validateMinimum=function(a){var b,c;if(""!==a.val())return b=parseInt(a.data("minimum")),c=parseInt(a.val()),b>c?this.showError(a,"minimum"):void 0},a.prototype.validateMaximum=function(a){var b,c;if(""!==a.val())return b=parseInt(a.data("maximum")),c=parseInt(a.val()),c>b?this.showError(a,"maximum"):void 0},a.prototype.validateNumber=function(a){var b;if(""!==a.val())return b=a.val(),isNaN(parseFloat(b))||!isFinite(b)?this.showError(a,"number"):void 0},a.prototype.validateConfirm=function(a){var b,c,d;if(""!==a.val())return c=a.data("confirm-target"),d=a.val(),b=$(c).val(),d!==b?this.showError(a,"confirm"):void 0},a.prototype.validateStripeNumber=function(a){var b;return b=a.val(),""!==b&&this.stripeKey?Stripe.validateCardNumber(b)?void 0:this.showError(a,"stripe-number"):void 0},a.prototype.validateStripeCVC=function(a){var b;return b=a.val(),""!==b&&this.stripeKey?Stripe.validateCVC(b)?void 0:this.showError(a,"stripe-cvc"):void 0},a.prototype.validateStripeExpiry=function(a){var b,c;return b=this.$el.find(a.data("expiry-month-target")),c=this.$el.find(a.data("expiry-year-target")),0!==b.length&&0!==c.length&&(b.hasClass("has-hint")&&b.val(""),c.hasClass("has-hint")&&c.val(""),""!==b.val()&&""!==c.val())?Stripe.validateExpiry(b.val(),c.val())?void 0:this.showError(a,"stripe-expiry"):void 0},a.prototype.showError=function(a,b){var c,d,e;return this.isValid(!1),a.addClass("has-error"),d=a.data("error-target"),c="undefined"!=typeof d?this.$el.find(d):$('<div class="error"></div>'),"undefined"!=typeof c&&(e=a.data("message-"+b),"undefined"==typeof e?(e=a.data("message"),c.html('<div class="error-msg">'+e+"</div>")):c.append('<div class="error-msg">'+e+"</div>")),"undefined"==typeof d?a.after(c):void 0},a.prototype.addHint=function(a){var b,c,d,e;if(""===a.val()&&(d=a.data("hint"),"undefined"!=typeof d))return a.addClass("has-hint"),a.val(d),e=this,c=function(){return $(this).val(""),a.removeClass("has-hint"),$(this).unbind("focus",c)},b=function(){return""===$(this).val()?($(this).unbind("blur",b),e.addHint($(this))):void 0},a.focus(c),a.blur(b)},a.prototype.isValid=function(a){return"undefined"==typeof this.valid&&(this.valid=!0),null!=a&&a===!1&&(this.valid=!1),this.valid},a.prototype.reset=function(){return this.valid=!0},a}(),$(function(){var c,d,e,f,g;for($("form").each(function(){return $(this).find("[data-validate]").length?new b($(this)):void 0}),f=$("[data-depends-on]"),g=[],d=0,e=f.length;e>d;d++)c=f[d],g.push(new a($(c)));return g})}).call(this);