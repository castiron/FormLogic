/* form-logic 2015-07-16 */
(function(){var a;this.FormLogic=function(){function a(){return a._instance?a._instance:(a._validators={},this.buildDefaultValidators(),this.setupValidationHandlers(),this.setupPrompts(),this.setupMasks(),this.hideErrorTargets(),this.fieldErrorClass="has-error",this.errorClass="error",void(a._instance=this))}return a.validate=function(b,c){if(!c||"function"!=typeof c)throw"The second argument passed to FormLogic.validator() must be a function.";return a._validators[b]=c},a.onBeforeValidation=function(a,b){if(!b||"function"!=typeof b)throw"The second argument passed to FormLogic.onBeforeValidation() must be a function.";return $(a).data("fl-before-validation-callback",b)},a.onValidSubmit=function(a,b){if(!b||"function"!=typeof b)throw"The second argument passed to FormLogic.onValidSubmit() must be a function.";return $(a).data("fl-valid-submit-callback",b)},a.onInvalidSubmit=function(a,b){if(!b||"function"!=typeof b)throw"The second argument passed to FormLogic.onInvalidSubmit() must be a function.";return $(a).data("fl-invalid-submit-callback",b)},a.prototype.setupMasks=function(){return $("[data-mask]").each(function(a,b){var c,d,e;return c=$(b),d=c.data("mask"),""!==$.trim(d)&&(e=c.prop("type"),"text"===e||"textfield"===e||"input"===e)?c.on("input",function(a){var b,c,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;for(e=$(this).val().replace(/( )+$/,""),n=function(){var a;return a=0,function(){return e.charAt(a++)}}(),m=function(a){var b;return b=n(),b?a(b)?b:m(a):!1},h=function(a){var b;return 47<(b=a.charCodeAt(0))&&58>b},f=function(a){var b,c;return 64<(b=a.charCodeAt(0))&&91>b||96<(c=a.charCodeAt(0))&&123>c},g=function(a){return h(a)||f(a)},k="",b=0,i="",p=q=0,s=d.length;s>=0?s>=q:q>=s;p=s>=0?++q:--q){switch(j=d.charAt(p)){case"0":l=m(h);break;case"A":l=m(f),l!==!1&&l.toUpperCase();break;case"a":l=m(f),l!==!1&&l.toLowerCase();break;case"Z":l=m(f);break;case"?":l=m(g);break;case"X":l=m(g),l!==!1&&l.toUpperCase();break;case"x":l=m(g),l!==!1&&l.toLowerCase();break;case"\\":l=d.charAt(++p);break;default:l=j,i+=j}if(l===!1)break;++b,k+=l}for(o=0,c=r=-1,t=-1*k.length;(t>=-1?t>=r:r>=t)&&k.substr(c,1)===i.substr(c,1);c=t>=-1?++r:--r)++o;return 0!==o&&(k=k.slice(0,-1*o),b-=o),this.setSelectionRange&&this.selectionStart!==e.length&&(b=this.selectionStart>e.length?this.selectionStart+1:this.selectionStart),$(this).val(k),this.setSelectionRange?this.setSelectionRange(b,b):void 0}):void 0})},a.prototype.setupPrompts=function(){var a,b,c,d,e,f,g;for(c=function(a){var b,c,d,e,f,g,h,i,j;for(a.show(),h=a.find("[name]").addBack("[name]"),d=0,f=h.length;f>d;d++)c=h[d],b=$('[data-prompt="'+$(c).attr("name")+'"]'),b&&$(c).change();for(i=a.find("[id]").addBack("[id]"),j=[],e=0,g=i.length;g>e;e++)c=i[e],b=$('[data-prompt="#'+$(c).attr("id")+'"]'),j.push(b?$(c).change():void 0);return j},b=function(a){var c,d,e,f,g,h,i,j,k;for(a.hide(),i=a.find("[name]").addBack("[name]"),e=0,g=i.length;g>e;e++)d=i[e],c=$('[data-prompt="'+$(d).attr("name")+'"]'),c&&b(c);for(j=a.find("[id]").addBack("[id]"),k=[],f=0,h=j.length;h>f;f++)d=j[f],c=$('[data-prompt="#'+$(d).attr("id")+'"]'),k.push(c?b(c):void 0);return k},f=$("form"),g=[],d=0,e=f.length;e>d;d++)a=f[d],g.push($("[data-prompt]").each(function(a,d){var e,f,g,h,i,j,k,l,m;return e=$(d),f=e.parents("form:first"),e.hide(),j=e.data("prompt"),g=$("#"===j.charAt(0)?f.find(j):f.find('[name="'+j+'"]')),h=e.data("show-if"),i=[],h&&(i=$.map(h.split(";"),function(a){return $.trim(a)})),m=g.prop("type"),l=g.attr("name"),k=function(){var a,d,g,h,j,k,n,o,p,q,r,s,t,u,v;switch(j=!1,o=[],n=$(this).val(),m){case"radio":case"checkbox":for(k=f.find('[name="'+l+'"]:checked'),p=0,s=k.length;s>p;p++)a=k[p],o.push($(a).val());break;case"select-one":case"select-multiple":for(v=$(this).find("option:selected"),q=0,t=v.length;t>q;q++)h=v[q],d=$(h).attr("value"),d&&o.push(d);break;default:o.push(n)}if(0===o.length)j=!1;else if(0===i.length&&o.length>0)j=!0;else for(r=0,u=i.length;u>r;r++)if(g=i[r],-1!==$.inArray(g,o)){j=!0;break}return j?c(e):b(e)},g.change(k),k.call(g)}));return g},a.prototype.hideErrorTargets=function(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;if(!a._instance){for(q=$("form"),k=0,n=q.length;n>k;k++)for(e=q[k],b=$(e),r=b.find("[data-validate]"),l=0,o=r.length;o>l;l++)if(f=r[l],c=$(f),j=c.data("validate"),"string"==typeof j)for(i=j.split(" "),m=0,p=i.length;p>m;m++)g=i[m],h=c.data("error-"+g),h||(h=c.data("error")),d=c.next("."+this.errorClass),h?$(h).hide():d&&d.hide();return!0}},a.prototype.setupValidationHandlers=function(){var a;return a=this,$("form").each(function(b,c){var d;return d=$(c),d.find("[data-validate]").each(function(b,c){var e;return e=$(c),"checkbox"!==$(this).attr("type")&&"radio"!==$(this).attr("type")?(e.blur(function(){return a.runValidators($(this),d)}),e.focus(function(){var b,c,d,e,f,g;if(d=$(this).data("validate"),"string"!=typeof d)return a.clearErrors($(this));for(c=d.split(" "),g=[],e=0,f=c.length;f>e;e++)b=c[e],g.push(a.clearErrors($(this),b));return g})):void 0}),d.submit(function(b){var c,d,e,f,g,h;for(d=!1,c=$(this).data("fl-before-validation-callback"),c&&"function"==typeof c&&c.call($(this),b),h=$(this).find("[data-validate]"),f=0,g=h.length;g>f;f++)e=h[f],a.runValidators($(e),$(this))||(d=!0);if(d)c=$(this).data("fl-invalid-submit-callback"),c&&"function"==typeof c&&c.call($(this),b);else if(c=$(this).data("fl-valid-submit-callback"),c&&"function"==typeof c)return c.call($(this),b);return!d})})},a.prototype.runValidators=function(b,c){var d,e,f,g,h,i;if(d=!1,(b.is(":hidden")&&!b.next(".chosen-container").length||b.is(":submit"))&&!b.data("force-validation"))return!0;if(g=b.data("validate"),"string"!=typeof g)return!1;for(f=g.split(" "),h=0,i=f.length;i>h;h++)e=f[h],a._validators[e]&&("required"===e||""!==b.val())&&(a._validators[e](b,c)||(this.showError(b,e),d=!0));return!d},a.prototype.clearErrors=function(a,b){var c,d;if(!a.is(":hidden")&&!a.is(":submit")||a.data("force-validation"))return a.removeClass(this.fieldErrorClass),b&&(d=a.data("error-"+b)),d||(d=a.data("error")),c=a.next("."+this.errorClass),d?$(d).hide():c?c.hide():void 0},a.prototype.showError=function(a,b){var c,d;return this.clearErrors(a,b),a.addClass(this.fieldErrorClass),b&&(c=a.data("message-"+b)),c||(c=a.data("message")),b&&(d=a.data("error-"+b)),d||(d=a.data("error")),d&&c?$(d).text(c).show():d?$(d).show():c?a.after('<div class="'+this.errorClass+'">'+c+"</div>"):void 0},a.prototype.buildDefaultValidators=function(){return a.validate("required",function(a,b){var c,d,e,f,g,h;if("radio"===a.attr("type")||"checkbox"===a.attr("type")){for(c=a.attr("name"),h=$('[name="'+c+'"]'),f=0,g=h.length;g>f;f++)if(d=h[f],$(d).is(":checked"))return!0;return!1}return e=a.val(),e&&""!==a.val()}),a.validate("email",function(a,b){var c;return c=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,c.test(a.val())}),a.validate("number",function(a,b){var c,d,e,f;return(c=function(a){return!isNaN(a)&&isFinite(a)&&/^[0-9]*\.?[0-9]+$/.test(a)})(a.val())?(f=parseFloat(a.val()),e=parseFloat(a.data("min")),d=parseFloat(a.data("max")),c(d)&&c(e)?f>=e&&d>=f:c(d)&&!c(e)?d>=f:!c(d)&&c(e)?f>=e:!0):!1}),a.validate("confirm",function(a,b){var c;return c=a.data("confirm-target"),a.val()===$(c).val()}),a.validate("phone",function(a,b){var c;return c=a.val().replace(/[^\d.]/g,""),c.length>6&&c.length<16}),a.validate("length",function(a,b){var c,d,e;return d=a.data("min"),c=a.data("max"),e=a.val().length,void 0!==c&&void 0!==d?e>=d&&c>=e:void 0!==c&&void 0===d?c>=e:void 0===c&&void 0!==d?e>=d:!0}),a.validate("card-cvc",function(a,b){var c;return 3<=(c=a.val().replace(/\D/g,"").length)&&4>=c}),a.validate("card-number",function(a,b){var c;return c=/^(?:4[0-9]{12}(?:[0-9]{3})?|5[1-5][0-9]{14}|3[47][0-9]{13}|3(?:0[0-5]|[68][0-9])[0-9]{11}|6(?:011|5[0-9]{2})[0-9]{12}|(?:2131|1800|35\d{3})\d{11})$/,null!==a.val().replace(/\D/g,"").match(c)})},a}(),a=new FormLogic}).call(this);